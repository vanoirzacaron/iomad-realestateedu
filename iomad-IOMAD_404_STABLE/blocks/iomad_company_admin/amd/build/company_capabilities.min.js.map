{"version":3,"file":"company_capabilities.min.js","sources":["../src/company_capabilities.js"],"sourcesContent":["/*\n * @package    block_iomad_company_admin\n * @copyright  2019 Howard Miller\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n /**\n  * @module block_iomad_company_admin/company_capabilities\n  */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/modal_factory', 'core/modal_events', 'core/str'],\n    function($, ajax, notification, ModalFactory, ModalEvents, str) {\n    return {\n        init: function(companyid, templateid, roleid) {\n\n            // Set/unset capability checkbox\n            $(\".capabilities-checkbox\").on('change', function() {\n                var capability = $(this).data(\"capability\");\n                var checked = $(this).prop('checked');\n                ajax.call([{\n                    methodname : 'block_iomad_company_admin_restrict_capability',\n                    args : {\n                        capability : capability,\n                        roleid : roleid,\n                        companyid : companyid,\n                        allow : checked,\n                        templateid: templateid\n                    },\n                    fail: notification.exception\n                }]);\n            });\n\n            // Template delete button.\n            // Note - have to manually show modal as modal events don't save the original\n            // clicked link :(\n            $('a.template-delete').on('click', function(e) {\n                var clickedLink = $(e.currentTarget);\n                var strings = [\n                    {\n                        key: 'deleteroletemplatefull',\n                        component: 'block_iomad_company_admin'\n                    },\n                    {\n                        key: 'deleteroletemplate',\n                        component: 'block_iomad_company_admin'\n                    },\n                    {\n                        key: 'delete'\n                    }\n                ];\n                str.get_strings(strings).then(function(strresults) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: strresults[1] + '  \"<b>' + clickedLink.data('name') + '</b>\"',\n                        body: strresults[0],\n                        })\n                        .then(function(modal) {\n                            modal.setSaveButtonText(strresults[2]);\n                            var root = modal.getRoot();\n                            root.on(ModalEvents.save, function() {\n                                var templateid = clickedLink.data('templateid');\n                                ajax.call([{\n                                    methodname: 'block_iomad_company_admin_capability_delete_template',\n                                    args : {\n                                        templateid: templateid\n                                    },\n                                    done: function() {\n                                        location.reload();\n                                    },\n                                    fail: notification.exception\n                                }]);\n                            });\n                            modal.show();\n                        });\n                    });\n            });\n        }\n    };\n});\n"],"names":["define","$","ajax","notification","ModalFactory","ModalEvents","str","init","companyid","templateid","roleid","on","capability","this","data","checked","prop","call","methodname","args","allow","fail","exception","e","clickedLink","currentTarget","get_strings","key","component","then","strresults","create","type","types","SAVE_CANCEL","title","body","modal","setSaveButtonText","getRoot","save","done","location","reload","show"],"mappings":";;;;;AAUAA,wDAAO,CAAC,SAAU,YAAa,oBAAqB,qBAAsB,oBAAqB,aAC3F,SAASC,EAAGC,KAAMC,aAAcC,aAAcC,YAAaC,WACpD,CACHC,KAAM,SAASC,UAAWC,WAAYC,QAGlCT,EAAE,0BAA0BU,GAAG,UAAU,eACjCC,WAAaX,EAAEY,MAAMC,KAAK,cAC1BC,QAAUd,EAAEY,MAAMG,KAAK,WAC3Bd,KAAKe,KAAK,CAAC,CACPC,WAAa,gDACbC,KAAO,CACHP,WAAaA,WACbF,OAASA,OACTF,UAAYA,UACZY,MAAQL,QACRN,WAAYA,YAEhBY,KAAMlB,aAAamB,gBAO3BrB,EAAE,qBAAqBU,GAAG,SAAS,SAASY,OACpCC,YAAcvB,EAAEsB,EAAEE,eActBnB,IAAIoB,YAbU,CACV,CACIC,IAAK,yBACLC,UAAW,6BAEf,CACID,IAAK,qBACLC,UAAW,6BAEf,CACID,IAAK,YAGYE,MAAK,SAASC,YACnC1B,aAAa2B,OAAO,CAChBC,KAAM5B,aAAa6B,MAAMC,YACzBC,MAAOL,WAAW,GAAK,SAAWN,YAAYV,KAAK,QAAU,QAC7DsB,KAAMN,WAAW,KAEhBD,MAAK,SAASQ,OACXA,MAAMC,kBAAkBR,WAAW,IACxBO,MAAME,UACZ5B,GAAGN,YAAYmC,MAAM,eAClB/B,WAAae,YAAYV,KAAK,cAClCZ,KAAKe,KAAK,CAAC,CACPC,WAAY,uDACZC,KAAO,CACHV,WAAYA,YAEhBgC,KAAM,WACFC,SAASC,UAEbtB,KAAMlB,aAAamB,gBAG3Be,MAAMO"}