{"version":3,"file":"students.min.js","sources":["../src/students.js"],"sourcesContent":["//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    local_learningpath\n * @copyright 2021 Derick Turner\n * @author    Derick Turner\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'jqueryui', 'core/config', 'core/ajax', 'core/notification'], function($, jqui, mdlcfg, ajax, notification) {\n\n    return {\n\n        /**\n         * Function to add students to the selected learning path.\n         *\n         * @param {int} companyid The Comany ID\n         * @param {int} pathid The path ID\n         *\n         **/\n        init: function(companyid, pathid) {\n            /**\n             * Function to filter the list of users.\n             *\n             * @param {array} users The list of users\n             *\n             **/\n            function apply_filter(users) {\n\n                // Check if there are any students\n                $('#prospectivelist li').remove();\n                if (users.length) {\n                    $('#noprospective').hide();\n                } else {\n                    $('#noprospective').show();\n                    $('#toomanyprospective').hide();\n                    return;\n                }\n\n                // Check if there are too many students\n                if (users.length > 30) {\n                    $('#toomanyprospective').show();\n                    return;\n                } else {\n                    $('#toomanyprospective').hide();\n                }\n\n                // Display updated list.\n                var items = [];\n                $.each(users, function(id, user) {\n                    items.push('<li class=\"text-truncate\" data-userid=\"' + user.id +\n                        '\"><i class=\"fa fa-user\"></i> ' + user.fullname + '</li>');\n                });\n                $('#prospectivelist').append(items.join(''));\n            }\n\n            /**\n             * Function to get the list of students vi an ajax call.\n             *\n             **/\n            function user_list() {\n\n                var filter = $('#userfilter').val();\n                var profilefieldid = $('#profilefieldid').val();\n\n                // Ajax stuff to get list\n                // call the web service\n                ajax.call([{\n                    methodname: 'local_iomad_learningpath_getprospectiveusers',\n                    args: {companyid: companyid, pathid: pathid, filter: filter, profilefieldid: profilefieldid},\n                    done: function(users) {\n                        apply_filter(users);\n                    },\n                    fail: notification.exception,\n                }]);\n            }\n\n            $(window).on('load', user_list(''));\n            $('#userfilter').on('input', function() {\n                user_list();\n            });\n            $('#profilefieldid').on('change', function() {\n                user_list();\n            });\n\n            $('#prospectivelist, #pathuserlist').on('mouseenter', 'li', function() {\n                $(this).addClass(\"text-primary\");\n            });\n            $('#prospectivelist, #pathuserlist').on('mouseleave', 'li', function() {\n                $(this).removeClass(\"text-primary\");\n            });\n\n            /**\n             * Function to add students to the selected learning path listing.\n             *\n             * @param {array} users The list of users.\n             *\n             **/\n            function apply_pathusers(users) {\n\n                // Check if there are any users\n                $('#pathuserlist li').remove();\n                if (users.length) {\n                    $('#nopathusers').hide();\n                } else {\n                    $('#nopathusers').show();\n                    return;\n                }\n\n                var items = [];\n                $.each(users, function(id, user) {\n                    items.push('<li class=\"text-truncate\" data-userid=\"' + user.id +\n                        '\"><i class=\"fa fa-user\"></i> ' + user.fullname + '</li>');\n                });\n                $('#pathuserlist').append(items.join(''));\n            }\n\n            /**\n             * Function to get the list of users in the path via an ajax call.\n             *\n             **/\n            function pathuser_list() {\n\n                // Ajax stuff to get list\n                // call the web service\n                ajax.call([{\n                    methodname: 'local_iomad_learningpath_getusers',\n                    args: {companyid: companyid, pathid: pathid},\n                    done: function(users) {\n                        apply_pathusers(users);\n                    },\n                    fail: notification.exception,\n                }]);\n            }\n\n            $(window).on('load', pathuser_list());\n\n            $('#prospectivelist').on('click', 'li', function() {\n                var userid = $(this).data('userid');\n\n                // Add the user to the path\n                ajax.call([{\n                    methodname: 'local_iomad_learningpath_addusers',\n                    args: {pathid: pathid, userids: [userid]},\n                    done: function() {\n                        pathuser_list();\n                        user_list();\n                    },\n                    fail: notification.exception,\n                }]);\n            });\n\n            $('#pathuserlist').on('click', 'li', function() {\n                var userid = $(this).data('userid');\n\n                // Remove the course from the path\n                ajax.call([{\n                    methodname: 'local_iomad_learningpath_removeusers',\n                    args: {pathid: pathid, userids: [userid]},\n                    done: function() {\n\n                        // Update list\n                        pathuser_list();\n                        user_list();\n                    },\n                    fail: notification.exception\n                }]);\n            });\n        }\n    };\n});\n"],"names":["define","$","jqui","mdlcfg","ajax","notification","init","companyid","pathid","user_list","filter","val","profilefieldid","call","methodname","args","done","users","remove","length","show","hide","items","each","id","user","push","fullname","append","join","apply_filter","fail","exception","pathuser_list","apply_pathusers","window","on","this","addClass","removeClass","userid","data","userids"],"mappings":";;;;;;AAqBAA,2CAAO,CAAC,SAAU,WAAY,cAAe,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,OAAQC,KAAMC,oBAErG,CASHC,KAAM,SAASC,UAAWC,iBAwCbC,gBAEDC,OAAST,EAAE,eAAeU,MAC1BC,eAAiBX,EAAE,mBAAmBU,MAI1CP,KAAKS,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,CAACR,UAAWA,UAAWC,OAAQA,OAAQE,OAAQA,OAAQE,eAAgBA,gBAC7EI,KAAM,SAASC,iBA3CDA,UAGlBhB,EAAE,uBAAuBiB,UACrBD,MAAME,cAGNlB,EAAE,kBAAkBmB,YACpBnB,EAAE,uBAAuBoB,UAHzBpB,EAAE,kBAAkBoB,OAQpBJ,MAAME,OAAS,GACflB,EAAE,uBAAuBmB,YAGzBnB,EAAE,uBAAuBoB,WAIzBC,MAAQ,GACZrB,EAAEsB,KAAKN,OAAO,SAASO,GAAIC,MACvBH,MAAMI,KAAK,0CAA4CD,KAAKD,GACxD,gCAAkCC,KAAKE,SAAW,YAE1D1B,EAAE,oBAAoB2B,OAAON,MAAMO,KAAK,MAkBhCC,CAAab,QAEjBc,KAAM1B,aAAa2B,sBAgDlBC,gBAIL7B,KAAKS,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAACR,UAAWA,UAAWC,OAAQA,QACrCQ,KAAM,SAASC,iBA9BEA,UAGrBhB,EAAE,oBAAoBiB,SAClBD,MAAME,QACNlB,EAAE,gBAAgBoB,WAMlBC,MAAQ,GACZrB,EAAEsB,KAAKN,OAAO,SAASO,GAAIC,MACvBH,MAAMI,KAAK,0CAA4CD,KAAKD,GACxD,gCAAkCC,KAAKE,SAAW,YAE1D1B,EAAE,iBAAiB2B,OAAON,MAAMO,KAAK,UATjC5B,EAAE,gBAAgBmB,OAwBdc,CAAgBjB,QAEpBc,KAAM1B,aAAa2B,aAtD3B/B,EAAEkC,QAAQC,GAAG,OAAQ3B,aACrBR,EAAE,eAAemC,GAAG,SAAS,WACzB3B,eAEJR,EAAE,mBAAmBmC,GAAG,UAAU,WAC9B3B,eAGJR,EAAE,mCAAmCmC,GAAG,aAAc,MAAM,WACxDnC,EAAEoC,MAAMC,SAAS,mBAErBrC,EAAE,mCAAmCmC,GAAG,aAAc,MAAM,WACxDnC,EAAEoC,MAAME,YAAY,mBA8CxBtC,EAAEkC,QAAQC,GAAG,OAAQH,iBAErBhC,EAAE,oBAAoBmC,GAAG,QAAS,MAAM,eAChCI,OAASvC,EAAEoC,MAAMI,KAAK,UAG1BrC,KAAKS,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CAACP,OAAQA,OAAQkC,QAAS,CAACF,SACjCxB,KAAM,WACFiB,gBACAxB,aAEJsB,KAAM1B,aAAa2B,gBAI3B/B,EAAE,iBAAiBmC,GAAG,QAAS,MAAM,eAC7BI,OAASvC,EAAEoC,MAAMI,KAAK,UAG1BrC,KAAKS,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CAACP,OAAQA,OAAQkC,QAAS,CAACF,SACjCxB,KAAM,WAGFiB,gBACAxB,aAEJsB,KAAM1B,aAAa2B"}